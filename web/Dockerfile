FROM node:14-alpine

WORKDIR /usr/app
COPY . .
RUN yarn

ARG FIREBASE_PRIVATE_KEY
ARG FIREBASE_CLIENT_EMAIL
ARG COOKIE_SECRET_CURRENT
ARG COOKIE_SECRET_PREVIOUS

ENV NEXT_PUBLIC_FIREBASE_PUBLIC_API_KEY=AIzaSyCJUWsDAQY9HnmcdmP6tb8-5wgiIyIt89w
ENV NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN=talkiewalkie-305117.firebaseapp.com
ENV NEXT_PUBLIC_FIREBASE_DATABASE_URL=https://talkiewalkie-305117-default-rtdb.europe-west1.firebasedatabase.app/
ENV NEXT_PUBLIC_FIREBASE_PROJECT_ID=talkiewalkie-305117
ENV FIREBASE_DATABASE_URL=https://talkiewalkie-305117-default-rtdb.europe-west1.firebasedatabase.app/
ENV FIREBASE_PRIVATE_KEY=$FIREBASE_PRIVATE_KEY
ENV FIREBASE_CLIENT_EMAIL=$FIREBASE_CLIENT_EMAIL
ENV COOKIE_SECRET_CURRENT=$COOKIE_SECRET_CURRENT
ENV COOKIE_SECRET_PREVIOUS=$COOKIE_SECRET_PREVIOUS

RUN yarn build

CMD [ "yarn", "start", "-p", "80" ]